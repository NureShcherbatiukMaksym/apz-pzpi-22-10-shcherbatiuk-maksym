{"ast":null,"code":"var _jsxFileName = \"D:\\\\Program Files\\\\WebstormProjects\\\\soil_scout\\\\web\\\\src\\\\components\\\\AnalyticsField.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef, useCallback } from 'react'; // Додано useCallback\nimport { useParams } from \"react-router-dom\";\nimport { Line as LineChart, Svg } from 'chartist';\nimport 'chartist/dist/chartist.css';\nimport api from '../utils/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AnalyticsField = () => {\n  _s();\n  const {\n    id\n  } = useParams(); // ID поточного вибраного поля з URL\n\n  const [timeRange, setTimeRange] = useState('7d');\n  const [chartData, setChartData] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const chartContainerRef = useRef(null);\n  const chartInstanceRef = useRef(null); // Для збереження інстансу графіка\n\n  // --- API Функції ---\n  // Використовуємо useCallback, щоб функції не створювались заново при кожному рендері,\n  // якщо їхні залежності не змінились (хоча тут залежностей немає, це хороша практика)\n  const selectField = useCallback(async fieldId => {\n    if (!fieldId) {\n      console.warn('[AnalyticsField:selectField] Спроба вибору поля без ID.');\n      return; // Нічого не робити, якщо немає ID\n    }\n    try {\n      console.log(`[AnalyticsField:selectField] Відправка запиту на select поля ID: ${fieldId}.`);\n      await api.post('/fields/select/', {\n        fieldId: fieldId\n      });\n      console.log(`[AnalyticsField:selectField] Поле ID ${fieldId} успішно вибрано.`);\n    } catch (err) {\n      console.error(`[AnalyticsField:selectField] Помилка при виборі поля ID ${fieldId}:`, err);\n      // Перекидуємо помилку, щоб її можна було обробити в fetchData\n      throw new Error(`Не вдалося вибрати поле ID ${fieldId}.`);\n    }\n  }, []); // Немає залежностей\n\n  const deselectField = useCallback(async fieldId => {\n    if (!fieldId) {\n      console.warn('[AnalyticsField:deselectField] Спроба деселекту поля без ID.');\n      return;\n    }\n    try {\n      console.log(`[AnalyticsField:deselectField] Відправка запиту на deselect поля ID: ${fieldId}.`);\n      await api.post('/fields/deselect/', {\n        fieldId: fieldId\n      });\n      console.log(`[AnalyticsField:deselectField:SUCCESS] Поле ID ${fieldId} успішно деселектнуто.`);\n    } catch (err) {\n      // Тут помилку можна просто залогувати, бо вона виникає при \"виході\"\n      console.error(`[AnalyticsField:deselectField:ERROR] Не вдалося деселектнути поле ID ${fieldId}:`, err);\n    }\n  }, []); // Немає залежностей\n\n  // --- Effect для Завантаження Даних та Вибору/Деселекту Поля ---\n  useEffect(() => {\n    // Якщо немає ID в URL, просто скидаємо стан\n    if (!id) {\n      console.log('[AnalyticsField:useEffect:data] Немає ID в URL, очищення стану.');\n      setChartData(null);\n      setError(null);\n      setIsLoading(false);\n      // Якщо був якийсь попередній ID, його треба деселектнути\n      // (хоча логіка залежностей useEffect має це обробити)\n      return;\n    }\n\n    // Створюємо асинхронну функцію всередині useEffect\n    const fetchDataForSelectedField = async () => {\n      setIsLoading(true);\n      setError(null);\n      setChartData(null); // Очищаємо старі дані перед новим запитом\n\n      try {\n        var _response$data;\n        // Крок 1: Вибрати поле. Чекаємо на завершення.\n        await selectField(id);\n\n        // Крок 2: Запитати дані для вибраного поля (яке тепер активне на бекенді)\n        const apiUrl = `/field-measurements/chart/${timeRange}`;\n        console.log(`[AnalyticsField:useEffect:data] Запит даних графіка з: ${apiUrl} (після вибору поля ${id})`);\n        const response = await api.get(apiUrl);\n\n        // Крок 3: Обробка відповіді\n        console.log('[AnalyticsField:useEffect:data] Отримано сирі дані:', response.data);\n        const rawData = (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.aggregatedData; // Безпечний доступ\n\n        // Перевірка, чи дані є масивом\n        if (!Array.isArray(rawData)) {\n          throw new Error('Некоректний формат відповіді від сервера або дані відсутні.');\n        }\n        console.log('[AnalyticsField:useEffect:data] Обробка масиву aggregatedData:', rawData);\n\n        // --- Логіка Трансформації Даних (залишається без змін) ---\n        const uniqueTimestampsSet = new Set();\n        rawData.forEach(sensor => {\n          if (sensor && Array.isArray(sensor.data)) {\n            sensor.data.forEach(entry => {\n              if (entry && entry.timestamp) {\n                uniqueTimestampsSet.add(entry.timestamp);\n              }\n            });\n          }\n        });\n        // Сортуємо мітки часу\n        const labels = Array.from(uniqueTimestampsSet).sort((a, b) => new Date(a) - new Date(b));\n        console.log('[AnalyticsField:useEffect:data] Згенеровані мітки (labels):', labels);\n        const series = rawData.map(sensor => {\n          const timestampToValueMap = new Map();\n          if (sensor && Array.isArray(sensor.data)) {\n            sensor.data.forEach(entry => {\n              // Перевіряємо, що значення не undefined і не null (Chartist погано обробляє undefined)\n              if (entry && entry.timestamp && entry.value !== undefined && entry.value !== null) {\n                timestampToValueMap.set(entry.timestamp, entry.value);\n              }\n            });\n          }\n          // Для кожної мітки часу шукаємо значення, якщо немає - ставимо null\n          const seriesData = labels.map(timestamp => {\n            var _timestampToValueMap$;\n            return (_timestampToValueMap$ = timestampToValueMap.get(timestamp)) !== null && _timestampToValueMap$ !== void 0 ? _timestampToValueMap$ : null;\n          });\n          return {\n            // Використовуємо назву сенсора або ID, якщо назви немає\n            name: sensor.sensorType || `Sensor ${sensor.sensorId || 'Unknown'}`,\n            data: seriesData\n          };\n        });\n        // Chartist очікує лише масив масивів значень\n        const chartistSeriesData = series.map(s => s.data);\n        console.log('[AnalyticsField:useEffect:data] Згенеровані серії (з іменами):', series);\n        console.log('[AnalyticsField:useEffect:data] Дані серій для Chartist:', chartistSeriesData);\n        // --- Кінець Трансформації Даних ---\n\n        // Перевіряємо, чи є хоч якісь дані для відображення\n        const hasDataPoints = chartistSeriesData.some(seriesData => Array.isArray(seriesData) && seriesData.some(point => point !== null));\n        if (labels.length === 0 || !hasDataPoints) {\n          console.log('[AnalyticsField:useEffect:data] Трансформовані дані порожні або містять тільки null.');\n          setChartData(null); // Встановлюємо null, щоб показати повідомлення \"Немає даних\"\n        } else {\n          setChartData({\n            labels,\n            series: chartistSeriesData\n          });\n        }\n        setError(null); // Скидаємо помилку при успішному завантаженні\n      } catch (err) {\n        // Обробка будь-яких помилок (з selectField або api.get)\n        console.error('[AnalyticsField:useEffect:data] Помилка під час вибору поля або завантаження даних:', err);\n        setError(err.message || 'Не вдалося завантажити дані графіка.'); // Використовуємо повідомлення з помилки, якщо є\n        setChartData(null); // Скидаємо дані при помилці\n      } finally {\n        // Завжди вимикаємо індикатор завантаження\n        setIsLoading(false);\n      }\n    };\n\n    // Викликаємо асинхронну функцію\n    fetchDataForSelectedField();\n\n    // --- Функція Очищення (Cleanup) ---\n    // Ця функція викликається, коли компонент розмонтовується АБО коли змінюється id чи timeRange (перед наступним запуском effect)\n    const fieldIdToDeselect = id; // Зберігаємо ID, який був активним під час цього запуску effect\n    return () => {\n      console.log(`[AnalyticsField:useEffect:data] Запуск очищення для ID: ${fieldIdToDeselect}`);\n      if (fieldIdToDeselect) {\n        // Викликаємо deselect для поля, яке було активним\n        deselectField(fieldIdToDeselect);\n      }\n      // Також можна зупинити будь-які активні запити, якщо використовується бібліотека типу Axios з AbortController\n      // console.log('[AnalyticsField:useEffect:data] Ефект очищено.');\n    };\n  }, [id, timeRange, selectField, deselectField]); // Додаємо selectField та deselectField до залежностей, оскільки вони тепер useCallback\n\n  // --- Effect для Рендерингу Графіка ---\n  useEffect(() => {\n    console.log('[AnalyticsField:useEffect:chart] Ефект рендерингу графіка. ChartData:', chartData ? 'є' : 'немає', 'Контейнер:', chartContainerRef.current ? 'є' : 'немає');\n\n    // Перевіряємо, чи є валідні дані для відображення\n    const isDataPlottable = chartData && Array.isArray(chartData.labels) && chartData.labels.length > 0 && Array.isArray(chartData.series) && chartData.series.length > 0 &&\n    // Перевіряємо, чи хоча б одна серія містить хоч одне не-null значення\n    chartData.series.some(seriesData => Array.isArray(seriesData) && seriesData.some(point => point !== null));\n    const container = chartContainerRef.current;\n    if (isDataPlottable && container && !isLoading) {\n      // Малюємо тільки якщо є дані, контейнер і не йде завантаження\n      console.log('[AnalyticsField:useEffect:chart] Малювання графіка...');\n      // Якщо графік вже існує, знищуємо його перед створенням нового\n      if (chartInstanceRef.current) {\n        try {\n          chartInstanceRef.current.detach();\n        } catch (err) {\n          console.error(\"Помилка при detach() старого графіка:\", err);\n        }\n        chartInstanceRef.current = null;\n      }\n\n      // Опції Chartist\n      const options = {\n        // low: 0, // Можливо, не варто обмежувати знизу, якщо дані можуть бути від'ємними?\n        fullWidth: true,\n        chartPadding: {\n          top: 20,\n          // Додаємо трохи відступу зверху\n          right: 40,\n          bottom: 60,\n          // Збільшуємо відступ знизу для довгих міток осі X\n          left: 20\n        },\n        axisX: {\n          // Форматування міток осі X\n          labelInterpolationFnc: function (value, index) {\n            // Показувати кожну N-ну мітку, щоб уникнути перекриття при великій к-сті даних\n            const step = Math.ceil(chartData.labels.length / 10); // Приблизно 10 міток\n            if (index % step !== 0) {\n              return null; // Не показувати цю мітку\n            }\n            try {\n              const date = new Date(value);\n              if (isNaN(date.getTime())) return value; // Якщо дата невалідна\n              // Формат: Дата, Час (01.01.2024 14:30)\n              return `${date.toLocaleDateString('uk-UA', {\n                day: '2-digit',\n                month: '2-digit',\n                year: 'numeric'\n              })} ${date.toLocaleTimeString('uk-UA', {\n                hour: '2-digit',\n                minute: '2-digit'\n              })}`;\n            } catch (e) {\n              console.error(\"Помилка форматування дати:\", value, e);\n              return value; // Повернути оригінальне значення при помилці\n            }\n          },\n          labelOffset: {\n            x: 0,\n            y: 10\n          } // Зсув міток осі X\n        },\n        axisY: {\n          onlyInteger: false,\n          // Дозволити не цілі числа на осі Y\n          labelInterpolationFnc: function (value) {\n            // Можна додати форматування, наприклад, одиниці виміру\n            return value;\n          },\n          offset: 50 // Збільшено відступ для міток осі Y\n        }\n        // Додамо плагін для підказок (tooltip) - потребує встановлення `chartist-plugin-tooltips`\n        // plugins: [\n        //     ChartistTooltip({ /* options */ }) // Потрібно імпортувати та налаштувати\n        // ]\n      };\n\n      // Створюємо новий графік\n      try {\n        chartInstanceRef.current = new LineChart(container, chartData, options);\n\n        // Додаємо анімацію (як було)\n        chartInstanceRef.current.on('draw', function (data) {\n          if (data.type === 'line' || data.type === 'area') {\n            data.element.animate({\n              d: {\n                begin: 500 * data.index,\n                // Трохи швидша анімація\n                dur: 1000,\n                from: data.path.clone().scale(1, 0).translate(0, data.chartRect.height()).stringify(),\n                to: data.path.clone().stringify(),\n                easing: Svg.Easing.easeOutQuint\n              }\n            });\n          }\n          // Можна додати анімацію для точок\n          if (data.type === 'point') {\n            data.element.animate({\n              opacity: {\n                begin: 500 * data.index,\n                dur: 500,\n                from: 0,\n                to: 1\n              }\n            });\n          }\n        });\n      } catch (chartError) {\n        console.error(\"Помилка створення або рендерингу графіка Chartist:\", chartError);\n        setError(\"Не вдалося відобразити графік.\");\n      }\n    } else if (chartInstanceRef.current) {\n      // Якщо дані не валідні або йде завантаження, а графік існує - знищуємо його\n      console.log('[AnalyticsField:useEffect:chart] Дані не готові або відсутні, знищення існуючого графіка.');\n      try {\n        chartInstanceRef.current.detach();\n      } catch (err) {\n        console.error(\"Помилка при detach() графіка (в блоці else):\", err);\n      }\n      chartInstanceRef.current = null;\n    }\n\n    // Функція очищення для ефекту рендерингу графіка\n    return () => {\n      console.log('[AnalyticsField:useEffect:chart] Запуск очищення ефекту рендерингу графіка.');\n      if (chartInstanceRef.current) {\n        try {\n          chartInstanceRef.current.detach();\n        } catch (err) {\n          console.error(\"Помилка при detach() графіка під час очищення:\", err);\n        }\n        chartInstanceRef.current = null;\n      }\n    };\n\n    // Залежності: дані, стан завантаження, контейнер (прямий доступ до .current не є реактивним,\n    // але потрібен для перевірки існування DOM-елемента). `isLoading` важливий,\n    // щоб не намагатися малювати графік під час завантаження нових даних.\n  }, [chartData, isLoading, error]); // Залежність від error також важлива, щоб прибрати графік при помилці\n\n  // --- Обробник Зміни Діапазону Часу ---\n  const handleTimeRangeChange = range => {\n    // Не оновлюємо, якщо вибрано той самий діапазон або йде завантаження\n    if (range !== timeRange && !isLoading) {\n      setTimeRange(range);\n    }\n  };\n  console.log(`[AnalyticsField] Рендер компонента. ID: ${id}, isLoading: ${isLoading}, error: ${error}, chartData: ${chartData ? 'є' : 'немає/порожньо'}`);\n\n  // --- JSX Рендеринг ---\n  return (\n    /*#__PURE__*/\n    // Використовуємо `h-full` або `min-h-screen` для батьківських контейнерів, якщо потрібно розтягнути контент\n    _jsxDEV(\"div\", {\n      id: \"main-content\",\n      className: \"w-full flex-1 bg-gray-100 p-6\",\n      children: [\" \", /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"max-w-7xl mx-auto\",\n        children: [\" \", /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-white shadow rounded-lg p-4 md:p-6\",\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-between items-center border-b border-gray-200 pb-3 mb-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n              className: \"text-xl font-bold text-gray-900\",\n              children: [\"\\u0410\\u043D\\u0430\\u043B\\u0456\\u0442\\u0438\\u043A\\u0430 \\u0432\\u0438\\u043C\\u0456\\u0440\\u044E\\u0432\\u0430\\u043D\\u044C \", id ? `для поля ID: ${id}` : '(Поле не вибрано)']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex space-x-2\",\n              children: ['7d', '6m', '1y'].map(range => /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleTimeRangeChange(range),\n                disabled: isLoading // Блокуємо кнопки під час завантаження\n                ,\n                className: `px-3 py-1 text-sm font-medium rounded transition-colors duration-150 ease-in-out ${timeRange === range ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'} ${isLoading ? 'opacity-50 cursor-not-allowed' : ''}` // Стилі для блокування\n                ,\n                children: [range === '7d' && '7 днів', range === '6m' && '6 міс', range === '1y' && '1 рік']\n              }, range, true, {\n                fileName: _jsxFileName,\n                lineNumber: 330,\n                columnNumber: 33\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 328,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative min-h-[350px]\",\n            children: [\" \", !id && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute inset-0 flex items-center justify-center\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-center text-gray-500 text-lg\",\n                children: \"\\u0411\\u0443\\u0434\\u044C \\u043B\\u0430\\u0441\\u043A\\u0430, \\u043E\\u0431\\u0435\\u0440\\u0456\\u0442\\u044C \\u043F\\u043E\\u043B\\u0435 \\u0437\\u0456 \\u0441\\u043F\\u0438\\u0441\\u043A\\u0443.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 353,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 352,\n              columnNumber: 29\n            }, this), id && isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-center text-gray-600 text-lg animate-pulse\",\n                children: \"\\u0417\\u0430\\u0432\\u0430\\u043D\\u0442\\u0430\\u0436\\u0435\\u043D\\u043D\\u044F \\u0434\\u0430\\u043D\\u0438\\u0445...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 360,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 29\n            }, this), id && error && !isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute inset-0 flex items-center justify-center\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-center text-red-600 text-lg px-4 py-2 bg-red-100 rounded border border-red-300\",\n                children: error\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 366,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 365,\n              columnNumber: 29\n            }, this), id && !isLoading && !error && !chartData &&\n            /*#__PURE__*/\n            // Показуємо, якщо не завантаження, немає помилки і chartData = null\n            _jsxDEV(\"div\", {\n              className: \"absolute inset-0 flex items-center justify-center\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-center text-gray-500 text-lg\",\n                children: \"\\u0414\\u0430\\u043D\\u0456 \\u0434\\u043B\\u044F \\u043E\\u0431\\u0440\\u0430\\u043D\\u043E\\u0433\\u043E \\u043F\\u043E\\u043B\\u044F \\u0437\\u0430 \\u0446\\u0435\\u0439 \\u043F\\u0435\\u0440\\u0456\\u043E\\u0434 \\u0432\\u0456\\u0434\\u0441\\u0443\\u0442\\u043D\\u0456.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 372,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 371,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `ct-chart ct-golden-section ${!id || isLoading || error || !chartData ? 'opacity-0' : 'opacity-100'} transition-opacity duration-300` // Ховаємо контейнер, якщо немає що показувати\n              ,\n              ref: chartContainerRef,\n              style: {\n                minHeight: '350px'\n              } // Забезпечуємо мінімальну висоту\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 349,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 9\n    }, this)\n  );\n};\n_s(AnalyticsField, \"AF2RZyH/ANrjtoxSPckbsjXLXE4=\", false, function () {\n  return [useParams];\n});\n_c = AnalyticsField;\nexport default AnalyticsField;\nvar _c;\n$RefreshReg$(_c, \"AnalyticsField\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useCallback","useParams","Line","LineChart","Svg","api","jsxDEV","_jsxDEV","AnalyticsField","_s","id","timeRange","setTimeRange","chartData","setChartData","isLoading","setIsLoading","error","setError","chartContainerRef","chartInstanceRef","selectField","fieldId","console","warn","log","post","err","Error","deselectField","fetchDataForSelectedField","_response$data","apiUrl","response","get","data","rawData","aggregatedData","Array","isArray","uniqueTimestampsSet","Set","forEach","sensor","entry","timestamp","add","labels","from","sort","a","b","Date","series","map","timestampToValueMap","Map","value","undefined","set","seriesData","_timestampToValueMap$","name","sensorType","sensorId","chartistSeriesData","s","hasDataPoints","some","point","length","message","fieldIdToDeselect","current","isDataPlottable","container","detach","options","fullWidth","chartPadding","top","right","bottom","left","axisX","labelInterpolationFnc","index","step","Math","ceil","date","isNaN","getTime","toLocaleDateString","day","month","year","toLocaleTimeString","hour","minute","e","labelOffset","x","y","axisY","onlyInteger","offset","on","type","element","animate","d","begin","dur","path","clone","scale","translate","chartRect","height","stringify","to","easing","Easing","easeOutQuint","opacity","chartError","handleTimeRangeChange","range","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","ref","style","minHeight","_c","$RefreshReg$"],"sources":["D:/Program Files/WebstormProjects/soil_scout/web/src/components/AnalyticsField.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from 'react'; // Додано useCallback\r\nimport { useParams } from \"react-router-dom\";\r\nimport { Line as LineChart, Svg } from 'chartist';\r\nimport 'chartist/dist/chartist.css';\r\nimport api from '../utils/api';\r\n\r\nconst AnalyticsField = () => {\r\n    const { id } = useParams(); // ID поточного вибраного поля з URL\r\n\r\n    const [timeRange, setTimeRange] = useState('7d');\r\n    const [chartData, setChartData] = useState(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState(null);\r\n\r\n    const chartContainerRef = useRef(null);\r\n    const chartInstanceRef = useRef(null); // Для збереження інстансу графіка\r\n\r\n    // --- API Функції ---\r\n    // Використовуємо useCallback, щоб функції не створювались заново при кожному рендері,\r\n    // якщо їхні залежності не змінились (хоча тут залежностей немає, це хороша практика)\r\n    const selectField = useCallback(async (fieldId) => {\r\n        if (!fieldId) {\r\n            console.warn('[AnalyticsField:selectField] Спроба вибору поля без ID.');\r\n            return; // Нічого не робити, якщо немає ID\r\n        }\r\n        try {\r\n            console.log(`[AnalyticsField:selectField] Відправка запиту на select поля ID: ${fieldId}.`);\r\n            await api.post('/fields/select/', { fieldId: fieldId });\r\n            console.log(`[AnalyticsField:selectField] Поле ID ${fieldId} успішно вибрано.`);\r\n        } catch (err) {\r\n            console.error(`[AnalyticsField:selectField] Помилка при виборі поля ID ${fieldId}:`, err);\r\n            // Перекидуємо помилку, щоб її можна було обробити в fetchData\r\n            throw new Error(`Не вдалося вибрати поле ID ${fieldId}.`);\r\n        }\r\n    }, []); // Немає залежностей\r\n\r\n    const deselectField = useCallback(async (fieldId) => {\r\n        if (!fieldId) {\r\n            console.warn('[AnalyticsField:deselectField] Спроба деселекту поля без ID.');\r\n            return;\r\n        }\r\n        try {\r\n            console.log(`[AnalyticsField:deselectField] Відправка запиту на deselect поля ID: ${fieldId}.`);\r\n            await api.post('/fields/deselect/', { fieldId: fieldId });\r\n            console.log(`[AnalyticsField:deselectField:SUCCESS] Поле ID ${fieldId} успішно деселектнуто.`);\r\n        } catch (err) {\r\n            // Тут помилку можна просто залогувати, бо вона виникає при \"виході\"\r\n            console.error(`[AnalyticsField:deselectField:ERROR] Не вдалося деселектнути поле ID ${fieldId}:`, err);\r\n        }\r\n    }, []); // Немає залежностей\r\n\r\n\r\n    // --- Effect для Завантаження Даних та Вибору/Деселекту Поля ---\r\n    useEffect(() => {\r\n        // Якщо немає ID в URL, просто скидаємо стан\r\n        if (!id) {\r\n            console.log('[AnalyticsField:useEffect:data] Немає ID в URL, очищення стану.');\r\n            setChartData(null);\r\n            setError(null);\r\n            setIsLoading(false);\r\n            // Якщо був якийсь попередній ID, його треба деселектнути\r\n            // (хоча логіка залежностей useEffect має це обробити)\r\n            return;\r\n        }\r\n\r\n        // Створюємо асинхронну функцію всередині useEffect\r\n        const fetchDataForSelectedField = async () => {\r\n            setIsLoading(true);\r\n            setError(null);\r\n            setChartData(null); // Очищаємо старі дані перед новим запитом\r\n\r\n            try {\r\n                // Крок 1: Вибрати поле. Чекаємо на завершення.\r\n                await selectField(id);\r\n\r\n                // Крок 2: Запитати дані для вибраного поля (яке тепер активне на бекенді)\r\n                const apiUrl = `/field-measurements/chart/${timeRange}`;\r\n                console.log(`[AnalyticsField:useEffect:data] Запит даних графіка з: ${apiUrl} (після вибору поля ${id})`);\r\n                const response = await api.get(apiUrl);\r\n\r\n                // Крок 3: Обробка відповіді\r\n                console.log('[AnalyticsField:useEffect:data] Отримано сирі дані:', response.data);\r\n                const rawData = response.data?.aggregatedData; // Безпечний доступ\r\n\r\n                // Перевірка, чи дані є масивом\r\n                if (!Array.isArray(rawData)) {\r\n                    throw new Error('Некоректний формат відповіді від сервера або дані відсутні.');\r\n                }\r\n                console.log('[AnalyticsField:useEffect:data] Обробка масиву aggregatedData:', rawData);\r\n\r\n                // --- Логіка Трансформації Даних (залишається без змін) ---\r\n                const uniqueTimestampsSet = new Set();\r\n                rawData.forEach(sensor => {\r\n                    if (sensor && Array.isArray(sensor.data)) {\r\n                        sensor.data.forEach(entry => {\r\n                            if (entry && entry.timestamp) {\r\n                                uniqueTimestampsSet.add(entry.timestamp);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n                // Сортуємо мітки часу\r\n                const labels = Array.from(uniqueTimestampsSet).sort((a, b) => new Date(a) - new Date(b));\r\n                console.log('[AnalyticsField:useEffect:data] Згенеровані мітки (labels):', labels);\r\n\r\n                const series = rawData.map(sensor => {\r\n                    const timestampToValueMap = new Map();\r\n                    if (sensor && Array.isArray(sensor.data)) {\r\n                        sensor.data.forEach(entry => {\r\n                            // Перевіряємо, що значення не undefined і не null (Chartist погано обробляє undefined)\r\n                            if (entry && entry.timestamp && entry.value !== undefined && entry.value !== null) {\r\n                                timestampToValueMap.set(entry.timestamp, entry.value);\r\n                            }\r\n                        });\r\n                    }\r\n                    // Для кожної мітки часу шукаємо значення, якщо немає - ставимо null\r\n                    const seriesData = labels.map(timestamp => timestampToValueMap.get(timestamp) ?? null);\r\n                    return {\r\n                        // Використовуємо назву сенсора або ID, якщо назви немає\r\n                        name: sensor.sensorType || `Sensor ${sensor.sensorId || 'Unknown'}`,\r\n                        data: seriesData\r\n                    };\r\n                });\r\n                // Chartist очікує лише масив масивів значень\r\n                const chartistSeriesData = series.map(s => s.data);\r\n                console.log('[AnalyticsField:useEffect:data] Згенеровані серії (з іменами):', series);\r\n                console.log('[AnalyticsField:useEffect:data] Дані серій для Chartist:', chartistSeriesData);\r\n                // --- Кінець Трансформації Даних ---\r\n\r\n                // Перевіряємо, чи є хоч якісь дані для відображення\r\n                const hasDataPoints = chartistSeriesData.some(seriesData =>\r\n                    Array.isArray(seriesData) && seriesData.some(point => point !== null)\r\n                );\r\n\r\n                if (labels.length === 0 || !hasDataPoints) {\r\n                    console.log('[AnalyticsField:useEffect:data] Трансформовані дані порожні або містять тільки null.');\r\n                    setChartData(null); // Встановлюємо null, щоб показати повідомлення \"Немає даних\"\r\n                } else {\r\n                    setChartData({ labels, series: chartistSeriesData });\r\n                }\r\n                setError(null); // Скидаємо помилку при успішному завантаженні\r\n\r\n            } catch (err) {\r\n                // Обробка будь-яких помилок (з selectField або api.get)\r\n                console.error('[AnalyticsField:useEffect:data] Помилка під час вибору поля або завантаження даних:', err);\r\n                setError(err.message || 'Не вдалося завантажити дані графіка.'); // Використовуємо повідомлення з помилки, якщо є\r\n                setChartData(null); // Скидаємо дані при помилці\r\n            } finally {\r\n                // Завжди вимикаємо індикатор завантаження\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        // Викликаємо асинхронну функцію\r\n        fetchDataForSelectedField();\r\n\r\n        // --- Функція Очищення (Cleanup) ---\r\n        // Ця функція викликається, коли компонент розмонтовується АБО коли змінюється id чи timeRange (перед наступним запуском effect)\r\n        const fieldIdToDeselect = id; // Зберігаємо ID, який був активним під час цього запуску effect\r\n        return () => {\r\n            console.log(`[AnalyticsField:useEffect:data] Запуск очищення для ID: ${fieldIdToDeselect}`);\r\n            if (fieldIdToDeselect) {\r\n                // Викликаємо deselect для поля, яке було активним\r\n                deselectField(fieldIdToDeselect);\r\n            }\r\n            // Також можна зупинити будь-які активні запити, якщо використовується бібліотека типу Axios з AbortController\r\n            // console.log('[AnalyticsField:useEffect:data] Ефект очищено.');\r\n        };\r\n\r\n    }, [id, timeRange, selectField, deselectField]); // Додаємо selectField та deselectField до залежностей, оскільки вони тепер useCallback\r\n\r\n\r\n    // --- Effect для Рендерингу Графіка ---\r\n    useEffect(() => {\r\n        console.log('[AnalyticsField:useEffect:chart] Ефект рендерингу графіка. ChartData:', chartData ? 'є' : 'немає', 'Контейнер:', chartContainerRef.current ? 'є' : 'немає');\r\n\r\n        // Перевіряємо, чи є валідні дані для відображення\r\n        const isDataPlottable = chartData &&\r\n            Array.isArray(chartData.labels) && chartData.labels.length > 0 &&\r\n            Array.isArray(chartData.series) && chartData.series.length > 0 &&\r\n            // Перевіряємо, чи хоча б одна серія містить хоч одне не-null значення\r\n            chartData.series.some(seriesData => Array.isArray(seriesData) && seriesData.some(point => point !== null));\r\n\r\n        const container = chartContainerRef.current;\r\n\r\n        if (isDataPlottable && container && !isLoading) { // Малюємо тільки якщо є дані, контейнер і не йде завантаження\r\n            console.log('[AnalyticsField:useEffect:chart] Малювання графіка...');\r\n            // Якщо графік вже існує, знищуємо його перед створенням нового\r\n            if (chartInstanceRef.current) {\r\n                try {\r\n                    chartInstanceRef.current.detach();\r\n                } catch (err) {\r\n                    console.error(\"Помилка при detach() старого графіка:\", err);\r\n                }\r\n                chartInstanceRef.current = null;\r\n            }\r\n\r\n            // Опції Chartist\r\n            const options = {\r\n                // low: 0, // Можливо, не варто обмежувати знизу, якщо дані можуть бути від'ємними?\r\n                fullWidth: true,\r\n                chartPadding: {\r\n                    top: 20, // Додаємо трохи відступу зверху\r\n                    right: 40,\r\n                    bottom: 60, // Збільшуємо відступ знизу для довгих міток осі X\r\n                    left: 20\r\n                },\r\n                axisX: {\r\n                    // Форматування міток осі X\r\n                    labelInterpolationFnc: function(value, index) {\r\n                        // Показувати кожну N-ну мітку, щоб уникнути перекриття при великій к-сті даних\r\n                        const step = Math.ceil(chartData.labels.length / 10); // Приблизно 10 міток\r\n                        if (index % step !== 0) {\r\n                            return null; // Не показувати цю мітку\r\n                        }\r\n                        try {\r\n                            const date = new Date(value);\r\n                            if (isNaN(date.getTime())) return value; // Якщо дата невалідна\r\n                            // Формат: Дата, Час (01.01.2024 14:30)\r\n                            return `${date.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit', year: 'numeric' })} ${date.toLocaleTimeString('uk-UA', { hour: '2-digit', minute:'2-digit' })}`;\r\n                        } catch (e) {\r\n                            console.error(\"Помилка форматування дати:\", value, e);\r\n                            return value; // Повернути оригінальне значення при помилці\r\n                        }\r\n                    },\r\n                    labelOffset: { x: 0, y: 10 }, // Зсув міток осі X\r\n                },\r\n                axisY: {\r\n                    onlyInteger: false, // Дозволити не цілі числа на осі Y\r\n                    labelInterpolationFnc: function(value) {\r\n                        // Можна додати форматування, наприклад, одиниці виміру\r\n                        return value;\r\n                    },\r\n                    offset: 50 // Збільшено відступ для міток осі Y\r\n                },\r\n                // Додамо плагін для підказок (tooltip) - потребує встановлення `chartist-plugin-tooltips`\r\n                // plugins: [\r\n                //     ChartistTooltip({ /* options */ }) // Потрібно імпортувати та налаштувати\r\n                // ]\r\n            };\r\n\r\n            // Створюємо новий графік\r\n            try {\r\n                chartInstanceRef.current = new LineChart(container, chartData, options);\r\n\r\n                // Додаємо анімацію (як було)\r\n                chartInstanceRef.current.on('draw', function(data) {\r\n                    if(data.type === 'line' || data.type === 'area') {\r\n                        data.element.animate({\r\n                            d: {\r\n                                begin: 500 * data.index, // Трохи швидша анімація\r\n                                dur: 1000,\r\n                                from: data.path.clone().scale(1, 0).translate(0, data.chartRect.height()).stringify(),\r\n                                to: data.path.clone().stringify(),\r\n                                easing: Svg.Easing.easeOutQuint\r\n                            }\r\n                        });\r\n                    }\r\n                    // Можна додати анімацію для точок\r\n                    if (data.type === 'point') {\r\n                        data.element.animate({\r\n                            opacity: {\r\n                                begin: 500 * data.index,\r\n                                dur: 500,\r\n                                from: 0,\r\n                                to: 1\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n\r\n            } catch (chartError) {\r\n                console.error(\"Помилка створення або рендерингу графіка Chartist:\", chartError);\r\n                setError(\"Не вдалося відобразити графік.\");\r\n            }\r\n\r\n        } else if (chartInstanceRef.current) {\r\n            // Якщо дані не валідні або йде завантаження, а графік існує - знищуємо його\r\n            console.log('[AnalyticsField:useEffect:chart] Дані не готові або відсутні, знищення існуючого графіка.');\r\n            try {\r\n                chartInstanceRef.current.detach();\r\n            } catch (err) {\r\n                console.error(\"Помилка при detach() графіка (в блоці else):\", err);\r\n            }\r\n            chartInstanceRef.current = null;\r\n        }\r\n\r\n        // Функція очищення для ефекту рендерингу графіка\r\n        return () => {\r\n            console.log('[AnalyticsField:useEffect:chart] Запуск очищення ефекту рендерингу графіка.');\r\n            if (chartInstanceRef.current) {\r\n                try {\r\n                    chartInstanceRef.current.detach();\r\n                } catch (err) {\r\n                    console.error(\"Помилка при detach() графіка під час очищення:\", err);\r\n                }\r\n                chartInstanceRef.current = null;\r\n            }\r\n        };\r\n\r\n        // Залежності: дані, стан завантаження, контейнер (прямий доступ до .current не є реактивним,\r\n        // але потрібен для перевірки існування DOM-елемента). `isLoading` важливий,\r\n        // щоб не намагатися малювати графік під час завантаження нових даних.\r\n    }, [chartData, isLoading, error]); // Залежність від error також важлива, щоб прибрати графік при помилці\r\n\r\n\r\n    // --- Обробник Зміни Діапазону Часу ---\r\n    const handleTimeRangeChange = (range) => {\r\n        // Не оновлюємо, якщо вибрано той самий діапазон або йде завантаження\r\n        if (range !== timeRange && !isLoading) {\r\n            setTimeRange(range);\r\n        }\r\n    };\r\n\r\n    console.log(`[AnalyticsField] Рендер компонента. ID: ${id}, isLoading: ${isLoading}, error: ${error}, chartData: ${chartData ? 'є' : 'немає/порожньо'}`);\r\n\r\n    // --- JSX Рендеринг ---\r\n    return (\r\n        // Використовуємо `h-full` або `min-h-screen` для батьківських контейнерів, якщо потрібно розтягнути контент\r\n        <div id=\"main-content\" className=\"w-full flex-1 bg-gray-100 p-6\"> {/* Додано фон і падінг */}\r\n            <div className=\"max-w-7xl mx-auto\"> {/* Обмежуємо максимальну ширину */}\r\n                <div className=\"bg-white shadow rounded-lg p-4 md:p-6\"> {/* Картка для графіка */}\r\n                    {/* Заголовок та кнопки вибору діапазону */}\r\n                    <div className=\"flex justify-between items-center border-b border-gray-200 pb-3 mb-4\">\r\n                        <h5 className=\"text-xl font-bold text-gray-900\">\r\n                            Аналітика вимірювань {id ? `для поля ID: ${id}` : '(Поле не вибрано)'}\r\n                        </h5>\r\n                        <div className=\"flex space-x-2\">\r\n                            {['7d', '6m', '1y'].map(range => (\r\n                                <button\r\n                                    key={range}\r\n                                    onClick={() => handleTimeRangeChange(range)}\r\n                                    disabled={isLoading} // Блокуємо кнопки під час завантаження\r\n                                    className={`px-3 py-1 text-sm font-medium rounded transition-colors duration-150 ease-in-out ${\r\n                                        timeRange === range\r\n                                            ? 'bg-blue-600 text-white hover:bg-blue-700'\r\n                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n                                    } ${isLoading ? 'opacity-50 cursor-not-allowed' : ''}`} // Стилі для блокування\r\n                                >\r\n                                    {range === '7d' && '7 днів'}\r\n                                    {range === '6m' && '6 міс'}\r\n                                    {range === '1y' && '1 рік'}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Контейнер для графіка та повідомлень */}\r\n                    <div className=\"relative min-h-[350px]\"> {/* Мінімальна висота для графіка */}\r\n                        {/* Повідомлення стану */}\r\n                        {!id && (\r\n                            <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                <p className=\"text-center text-gray-500 text-lg\">\r\n                                    Будь ласка, оберіть поле зі списку.\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n                        {id && isLoading && (\r\n                            <div className=\"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10\">\r\n                                <p className=\"text-center text-gray-600 text-lg animate-pulse\">Завантаження даних...</p>\r\n                                {/* Можна додати спінер тут */}\r\n                            </div>\r\n                        )}\r\n                        {id && error && !isLoading && (\r\n                            <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                <p className=\"text-center text-red-600 text-lg px-4 py-2 bg-red-100 rounded border border-red-300\">{error}</p>\r\n                            </div>\r\n                        )}\r\n                        {/* Повідомлення \"Немає даних\" */}\r\n                        {id && !isLoading && !error && !chartData && ( // Показуємо, якщо не завантаження, немає помилки і chartData = null\r\n                            <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                <p className=\"text-center text-gray-500 text-lg\">\r\n                                    Дані для обраного поля за цей період відсутні.\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Власник контейнер для графіка */}\r\n                        {/* Ми додаємо/видаляємо графік динамічно, тому повідомлення показуються поверх */}\r\n                        <div\r\n                            className={`ct-chart ct-golden-section ${!id || isLoading || error || !chartData ? 'opacity-0' : 'opacity-100'} transition-opacity duration-300`} // Ховаємо контейнер, якщо немає що показувати\r\n                            ref={chartContainerRef}\r\n                            style={{minHeight: '350px'}} // Забезпечуємо мінімальну висоту\r\n                        >\r\n                            {/* Chartist буде малювати сюди */}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* --- Видалено секцію з таблицею та правою колонкою --- */}\r\n                {/* Якщо вони потрібні, їх треба реалізувати з відповідною логікою */}\r\n                {/*\r\n                 <div className=\"mt-6 bg-white shadow rounded-lg p-4 md:p-6\">\r\n                     <h5 className=\"text-xl font-bold text-gray-900 border-b pb-3 mb-4\">Додаткова інформація</h5>\r\n                     { // Тут може бути таблиця з даними або інші елементи\r\n                     }\r\n                 </div>\r\n                 */}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AnalyticsField;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}